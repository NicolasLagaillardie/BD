#install the required packages if needed
#install.packages("funFEM")
#install.packages("fda")

#load the required libraries
library(funFEM)
library(fda)

# DATA ----
data(velib)   # hourly data one 1 week, from Sunday 1st Sept. - Sunday 7th Sept
data<-velib$data

#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%                                         %%%%%%%%%%%%%%%%%%%%%%%%%%%
###########################         (1) Visualize the data          ###########################
#%%%%%%%%%%%%%%%%%%%%%%%%%%                                         %%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

matplot(???,type='l',lwd=2,ylim=c(0,1))

#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%                                         %%%%%%%%%%%%%%%%%%%%%%%%%%%
########################### (2) Adjust the data using Fourier basis ###########################
#%%%%%%%%%%%%%%%%%%%%%%%%%%                                         %%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

nbasis <- ???
basis <- create.fourier.basis(rangeval=???, nbasis= ???) 
fdobj <- smooth.basis(argvals=???, fdParobj=???, nbasis=???)$fd
matplot(???,type='l',lwd=2,ylim=c(0,1))
lines(???)

#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%                                         %%%%%%%%%%%%%%%%%%%%%%%%%%%
###########################      (3) Carry out PCA on the data      ###########################
#%%%%%%%%%%%%%%%%%%%%%%%%%%                                         %%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

q=??? # number of principal components
pca_smooth_X <- pca.fd(fdobj=???, nharm=q)
plot.pca.fd( ???)


#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%                                                        %%%%%%%%%%%%%%%%%%%%%%%%%%%
########################### (3) Clustering over the Fourier basis and over the PCA ###########################
#%%%%%%%%%%%%%%%%%%%%%%%%%%                                                        %%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


K <- ???

###################  [a] Fourier  #################
cl<- kmeans(???, K)

# reconstruction of the clusters' centers
fct_basis<- eval.basis(evalarg=???,basisobj=???) # function value in the Fourier basis
centers = fct_basis %*% ???

###################  [b] ACP  #################
clFPCA<- kmeans(???, K)

# reconstruction of the clusters' centers
coeff_of_the_centers_in_original_plan<-???
average_of_the_data<-???
centersFPCA = coeff_in_original_plan%*%t(fct_basis) + average_of_the_data

# plot of the centers
par(mfrow = c(1,1))
matplot(???, ???, type = "l", col=1:K, main = "???")
matplot(???, ???, type = "l", col=1:K, main = "???")

# ################# [c] Plot ###############

library(ggmap) 
load("Mymap")
ggmap(Mymap) + geom_point(data=velib$position,aes(longitude,latitude),
                          colour = I(your_cluster_Fourier), size = I(3), shape = your_cluster_Fourier)

ggmap(Mymap) + geom_point(data=velib$position,aes(longitude,latitude),
                          colour = I(your_cluster_FPCA), size = I(3), shape = your_cluster_FPCA)

#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%                                         %%%%%%%%%%%%%%%%%%%%%%%%%%%
###########################             (4) Prediction              ###########################
#%%%%%%%%%%%%%%%%%%%%%%%%%%                                         %%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

#Your turn!

#Good luck!